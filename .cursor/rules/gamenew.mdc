---
description: 
globs: 
alwaysApply: true
---
---
description: Game-News-Express 專案的 Cursor 規範，統一撰寫／審查程式碼與文件時的品質與一致性。
globs:
  - "**/*.ts"
  - "**/*.tsx"
  - "**/*.js"
  - "**/*.md"
---
# Cursor Rules

## 通用規範（Global Rules）

### 技術棧 (Tech Stack)
- **前端**：Next.js 14、React 18、Tailwind CSS 3
- **執行環境**：Node.js 18、TypeScript 5  
- **爬蟲**：Playwright（公主連結）、Puppeteer（蔚藍檔案）
- **後端 / 資料庫**：Supabase
- **AI 模型**：Ollama (gemma3:4b，本地) :contentReference[oaicite:0]{index=0}

### 開發約定 (Coding Conventions)
- 使用 **ESLint**（`next/core-web-vitals`）＋ **Prettier**，2 空格縮排，統一 LF
- TypeScript 開啟 `strict` 模式
- 貫徹〈Clean Code Guidelines〉：常數取代魔數、語意命名、單一職責、DRY、封裝、測試

### 全局事件 (Always Do)
1. **提交 PR 前自動執行**：`npm run lint && npm run test`  
2. PR 描述必含「**變更概要**」與「**下一步計畫**」兩小節  
3. Cursor 產生程式碼時，先給 **TL;DR**，再貼完整 code block

### 限制 (Restrictions)
- 嚴禁在程式碼中硬編碼任何 `.env.local` 機密
- 不得生成違反目標網站 TOS 的高頻爬蟲邏輯
- 不得輸出未經驗證的毀損性 SQL 或 Shell 指令

---

## 專案框架規範（Project-Specific Rules）

### 專案目標 (Project Goal)
集中爬取多款遊戲官網公告，透過本地 AI 分析後，以結構化形式呈現給玩家；首波支援 **公主連結** 與 **蔚藍檔案**。:contentReference[oaicite:1]{index=1}

### 目錄結構 (Folder Structure)
/
├─ pages/ # (或 app/) 平台入口頁
├─ games/[slug]/ # 個別遊戲動態路由
├─ scripts/ # 爬蟲腳本 (bluearchive)
├─ src/lib/ # 共用模組 (crawler.ts, supabase.ts, ollama.ts)
└─ tests/ # 單元 & E2E 測試


### 命名規則 (Naming Rules)
- 變數／函式：`camelCase`  
- React 元件 & TS 型別：`PascalCase`  
- 檔案：`kebab-case.ts(x)`；資料夾：全小寫多字以連字號分隔

### 模組分層 (Module Architecture)
- **Crawler Layer**：`scripts/`、`src/lib/crawler.ts`  
- **Service Layer**：`src/lib/` 內整合 Supabase 與 Ollama  
- **UI Layer**：Next.js Pages / App Router + Tailwind CSS

### 程式碼品質 (Code Quality)
- **Jest + Playwright** 測試覆蓋率 ≥ 80 %
- CI 測試或 Lint 失敗即阻擋合併

### 部署流程 (Deployment Pipeline)
1. GitHub Actions：`push` ➜ `npm ci` ➜ `npm run lint` ➜ `npm run test`
2. `main` 分支通過後自動建置並部署至 **Vercel**
3. Supabase 資料庫遷移腳本自動套用

### 資安／隱私 (Security & Privacy)
- `.env.local` 不可提交至 Git
- 日誌需遮蔽使用者 IP、Cookie 等敏感資訊
- 爬蟲遵守 robots.txt，單站輪詢間隔 ≥ 30 秒

### 其他限制 (Additional Constraints)
- 執行爬蟲前必須檢查本地 Ollama 服務狀態；若未啟動則終止任務並回報
- 任何毀損性資料庫操作須先備份並經雙人審核


